# üöÄ –î–µ–ø–ª–æ–π Sabina School

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GitHub Actions.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker Hub](#1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-docker-hub)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets](#2-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-github-secrets)
3. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ VPS —Å–µ—Ä–≤–µ—Ä–∞](#3-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-vps-—Å–µ—Ä–≤–µ—Ä–∞)
4. [–ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π](#4-–ø–µ—Ä–≤—ã–π-–¥–µ–ø–ª–æ–π)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã](#5-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã)

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker Hub

### 1.1 –°–æ–∑–¥–∞–π –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ Docker Hub

- –û—Ç–∫—Ä–æ–π https://hub.docker.com/
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

### 1.2 –°–æ–∑–¥–∞–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

- –ù–∞–∂–º–∏ **Create Repository**
- **Name:** `sabina-school`
- **Visibility:** Public (–∏–ª–∏ Private, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞)
- –ù–∞–∂–º–∏ **Create**

### 1.3 –ü–æ–ª—É—á–∏ Access Token

- –û—Ç–∫—Ä–æ–π https://hub.docker.com/settings/security
- –ù–∞–∂–º–∏ **New Access Token**
- **Description:** `github-actions-deploy`
- **Access permissions:** Read, Write, Delete
- –ù–∞–∂–º–∏ **Generate**
- **–°–ö–û–ü–ò–†–£–ô –¢–û–ö–ï–ù** (–æ–Ω –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∂–µ—Ç—Å—è!)

---

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–û—Ç–∫—Ä–æ–π —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub:
https://github.com/YevgeniyAbramov/sabina-school

### 2.1 –ü–µ—Ä–µ–π–¥–∏ –≤ Settings ‚Üí Secrets and variables ‚Üí Actions

### 2.2 –î–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ secrets (–∫–Ω–æ–ø–∫–∞ "New repository secret"):

| Name                 | Value                         | –ü—Ä–∏–º–µ—Ä              |
| -------------------- | ----------------------------- | ------------------- |
| `DOCKERHUB_USERNAME` | –¢–≤–æ–π –ª–æ–≥–∏–Ω Docker Hub         | `yevgeniyabramov`   |
| `DOCKERHUB_TOKEN`    | Access Token –∏–∑ –ø. 1.3        | `dckr_pat_xxxxx...` |
| `VPS_HOST`           | IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞              | `123.45.67.89`      |
| `VPS_USERNAME`       | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ       | `root` –∏–ª–∏ `ubuntu` |
| `VPS_PORT`           | SSH –ø–æ—Ä—Ç                      | `22`                |
| `VPS_SSH_KEY`        | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á            | —Å–º. —Ä–∞–∑–¥–µ–ª 3.2      |
| `DB_USER`            | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î               | `admin`             |
| `DB_PASSWORD`        | –ü–∞—Ä–æ–ª—å –ë–î (–ø—Ä–∏–¥—É–º–∞–π —Å–ª–æ–∂–Ω—ã–π!) | `MyStr0ngP@ssw0rd!` |
| `DB_NAME`            | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö               | `sabina_school`     |

---

## 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ VPS —Å–µ—Ä–≤–µ—Ä–∞

### 3.1 –ü–æ–ª—É—á–∏ VPS —Å–µ—Ä–≤–µ—Ä

–í–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:

- **DigitalOcean** ($6/–º–µ—Å) - https://www.digitalocean.com/
- **Hetzner** (‚Ç¨4/–º–µ—Å) - https://www.hetzner.com/
- **Timeweb** (‚ÇΩ300/–º–µ—Å) - https://timeweb.cloud/
- **REG.RU** (‚ÇΩ350/–º–µ—Å) - https://www.reg.ru/

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

- Ubuntu 20.04/22.04 LTS
- –ú–∏–Ω–∏–º—É–º 1GB RAM
- 1 CPU
- 25GB SSD

### 3.2 –ù–∞—Å—Ç—Ä–æ–π SSH –¥–æ—Å—Ç—É–ø

**–ù–∞ —Å–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**

```bash
# –°–æ–∑–¥–∞–π SSH –∫–ª—é—á (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
ssh-keygen -t ed25519 -C "github-actions-deploy"

# –°–∫–æ–ø–∏—Ä—É–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/id_ed25519.pub root@YOUR_SERVER_IP

# –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@YOUR_SERVER_IP

# –í—ã–≤–µ–¥–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è GitHub Secret
cat ~/.ssh/id_ed25519
```

–°–∫–æ–ø–∏—Ä—É–π **–≤–µ—Å—å –≤—ã–≤–æ–¥** (–≤–∫–ª—é—á–∞—è `-----BEGIN` –∏ `-----END`) –≤ GitHub Secret `VPS_SSH_KEY`.

### 3.3 –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
# –°–∫–∞—á–∞–π –∏ –∑–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç
curl -o setup.sh https://raw.githubusercontent.com/YevgeniyAbramov/sabina-school/main/deploy/setup-server.sh
chmod +x setup.sh
./setup.sh
```

–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç:

- ‚úÖ Docker
- ‚úÖ Docker Compose
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/opt/sabina-school`
- ‚úÖ –°–∫–∞—á–∞–µ—Ç `docker-compose.yml`
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç `.env` —Ñ–∞–π–ª

### 3.4 –ù–∞—Å—Ç—Ä–æ–π .env —Ñ–∞–π–ª

```bash
cd /opt/sabina-school
nano .env
```

**–ò–∑–º–µ–Ω–∏:**

- `db_password` - –Ω–∞ **—Ç–æ—Ç –∂–µ –ø–∞—Ä–æ–ª—å**, —á—Ç–æ —É–∫–∞–∑–∞–ª –≤ GitHub Secret `DB_PASSWORD`
- `DOCKERHUB_USERNAME` - —Ç–≤–æ–π –ª–æ–≥–∏–Ω Docker Hub

–°–æ—Ö—Ä–∞–Ω–∏: `Ctrl+O`, `Enter`, `Ctrl+X`

---

## 4. –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions

–ü—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π `git push` –≤ –≤–µ—Ç–∫—É `main`:

```bash
cd /Users/abramov/Documents/sabina-sckool
git add .
git commit -m "Setup GitHub Actions deployment"
git push origin main
```

**GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

1. ‚úÖ –°–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑
2. ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç –µ–≥–æ –≤ Docker Hub
3. ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
4. ‚úÖ –°–∫–∞—á–∞–µ—Ç –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

–û—Ç–∫—Ä–æ–π: https://github.com/YevgeniyAbramov/sabina-school/actions

–¢–∞–º —É–≤–∏–¥–∏—à—å –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 5.1 –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
ssh root@YOUR_SERVER_IP
cd /opt/sabina-school

# –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã:
# sabina_school_app
# sabina_school_db

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑!)
./init-db.sh

# –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏
docker-compose logs -f app
```

### 5.2 –í –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π: `http://YOUR_SERVER_IP:3000`

**–¢–µ—Å—Ç–æ–≤—ã–π –≤—Ö–æ–¥:**

- –õ–æ–≥–∏–Ω: `test`
- –ü–∞—Ä–æ–ª—å: `test`

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º `git push` –≤ –≤–µ—Ç–∫—É `main` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π!

---

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
cd /opt/sabina-school
docker-compose restart

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
docker-compose pull
docker-compose up -d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-compose down

# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ë–î
docker exec -it sabina_school_db psql -U admin -d sabina_school

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î
docker exec sabina_school_db pg_dump -U admin sabina_school > backup_$(date +%Y%m%d).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
docker exec -i sabina_school_db psql -U admin -d sabina_school < backup.sql
```

---

## ‚ùó –í–∞–∂–Ω–æ

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

   - –°–º–µ–Ω–∏ –ø–∞—Ä–æ–ª—å `test/test` –≤ –ë–î –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
   - –ù–∞—Å—Ç—Ä–æ–π —Ñ–∞–π—Ä–≤–æ–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

2. **SSL/HTTPS:**

   - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π Nginx + Let's Encrypt
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: https://certbot.eff.org/

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ù–∞—Å—Ç—Ä–æ–π –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ—á—Ç—É –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π Uptime Robot (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

---

## üÜò –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ GitHub Actions
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `docker-compose logs -f`
3. –ü—Ä–æ–≤–µ—Ä—å .env —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤—Å–µ GitHub Secrets –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
